# Backend Dockerfile.dev - Modo Desenvolvimento com Hot Reload
FROM node:22-alpine

WORKDIR /app

# Instalar dependências do sistema
RUN apk add --no-cache python3 make g++

# Copiar package.json
COPY package*.json ./
COPY prisma ./prisma/

# Instalar dependências (incluindo devDependencies)
RUN npm install

# Gerar Prisma Client
RUN npx prisma generate

# Criar diretório de logs
RUN mkdir -p /app/logs

# Expor portas (app + debug)
EXPOSE 3000 9229

# Iniciar em modo watch com debug habilitado
CMD ["sh", "-c", "npx prisma migrate dev --skip-generate 2>/dev/null || true && npm run start:debug"]
