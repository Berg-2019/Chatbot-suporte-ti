# =============================================================================
# CONFIGURAÇÃO DOCKER - Bot WhatsApp Atendimento Técnico
# =============================================================================
# IMPORTANTE: Crie um arquivo .env com as variáveis antes de executar!
# Use o arquivo .env.example como referência.
# NOTA: Use 'docker compose' (v2) em vez de 'docker-compose' (v1)
# =============================================================================

services:
  # Bot WhatsApp de Atendimento
  bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bot-whatsapp-atendimento
    ports:
      - "${BOT_PORT:-3003}:3003"
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - PORT=3003
      - BOT_NAME=${BOT_NAME:-Bot de Atendimento Técnico}
      - PREFIX=${PREFIX:-!}
      - BOT_PHONE_NUMBER=${BOT_PHONE_NUMBER:-}
      - GRUPO_TECNICO_ID=${GRUPO_TECNICO_ID:-}
      - ROOT_NUMBERS=${ROOT_NUMBERS:-556981170027,556884268042}
      # Configurações de Email (opcional)
      - EMAIL_ENABLED=${EMAIL_ENABLED:-false}
      - EMAIL_HOST=${EMAIL_HOST:-}
      - EMAIL_PORT=${EMAIL_PORT:-587}
      - EMAIL_USER=${EMAIL_USER:-}
      - EMAIL_PASS=${EMAIL_PASS:-}
      - EMAIL_FROM=${EMAIL_FROM:-}
    volumes:
      # Persistir dados de autenticação do WhatsApp
      - whatsapp_auth:/app/auth_info_baileys
      # Persistir banco de dados SQLite
      - bot_database:/app/db
      # Persistir backups
      - bot_backups:/app/backups
      # Persistir logs
      - bot_logs:/app/logs
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('OK')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    networks:
      - bot-network

networks:
  bot-network:
    driver: bridge

volumes:
  whatsapp_auth:
    name: bot-whatsapp-auth
  bot_database:
    name: bot-whatsapp-db
  bot_backups:
    name: bot-whatsapp-backups
  bot_logs:
    name: bot-whatsapp-logs
